```tikz
\begin{document}
\tikzset{
    biggrid/.style={very thick, black},
    cell/.style={minimum width=1cm, minimum height=1cm, anchor=center},
    digit/.style={font=\bfseries\Large},
    hint/.style={font=\scriptsize, black!70},
    highlight/.style={fill=gray!40, opacity=0.3}
}

% === 坐标换算：将 row, col 转为坐标 ===
\newcommand{\cellpos}[2]{%
    % #1=row (1–9), #2=col (1–9)
    \pgfmathsetmacro{\x}{(#2-1)*3}
    \pgfmathsetmacro{\y}{(9-#1)*3}
}

% === 绘制整盘 ===
\newcommand{\drawboard}{
    % 外框
    \draw[step=3cm, very thin, black!50] (0,0) grid (27,27);
    % 粗线（每3格加粗）
    \foreach \i in {0,9,18,27}{
        \draw[biggrid] (\i,0)--(\i,27);
        \draw[biggrid] (0,\i)--(27,\i);
    }
}

% === 设置候选数 ===
\newcommand{\setcandidates}[3]{%
    % #1=row, #2=col, #3={候选数字列表，如 1,3,7}
    \cellpos{#1}{#2}
    \begin{scope}[shift={(\x,\y)}]
        \foreach \n in {1,...,9} {
            \pgfmathtruncatemacro{\xx}{mod(\n-1,3)}
            \pgfmathtruncatemacro{\yy}{2-floor((\n-1)/3)}
            % 检查 \n 是否在列表中
            \foreach \m in {#3} {
                \ifnum\n=\m
                    \node[hint] at (0.5+\xx,0.5+\yy) {\n};
                \fi
            }
        }
    \end{scope}
}

% === 设置主数字 ===
\newcommand{\setdigit}[3]{%
    \cellpos{#1}{#2}
    \node[digit] at (\x+1.5,\y+1.5) {#3};
}

% === 高亮矩形 ===
\newcommand{\highlightrectangle}[4]{%
    \cellpos{#1}{#2}
    \pgfmathsetmacro{\xA}{\x}
    \pgfmathsetmacro{\yA}{\y}
    \cellpos{#3}{#4}
    \pgfmathsetmacro{\xB}{\x+3}
    \pgfmathsetmacro{\yB}{\y+3}
    \fill[highlight] (\xA,\yA) rectangle (\xB,\yB);
}

\begin{tikzpicture}[scale=0.4]
    % 绘制棋盘
    \drawboard

    % 示例主数字
    \setdigit{1}{3}{9}
    \setdigit{1}{7}{2}
    \setdigit{1}{8}{6}
    \setdigit{2}{1}{2}
    \setdigit{2}{5}{8}
    \setdigit{2}{6}{4}

    % 示例候选数
    \setcandidates{4}{5}{1,3,5,7}
    \setcandidates{5}{5}{2,4,6,8,9}

    % 示例高亮区域
    \highlightrectangle{1}{4}{3}{6}
\end{tikzpicture}
\end{document}
